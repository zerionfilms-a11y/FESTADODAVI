<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Visualizador — Cabine</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="theme-color" content="#ffffff">
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
  <style>
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%;margin:0;font-family:Arial,Helvetica,sans-serif;background:#ffffff;color:#222222;overflow:auto}
    .wrap{max-width:1100px;margin:32px auto;padding:20px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:18px}
    header img{height:48px}
    h1{font-size:20px;margin:0;color:#222222}
    .gallery{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}
    .thumb{background:#fff;border:1px solid rgba(0,0,0,0.06);padding:8px;border-radius:8px;overflow:hidden;display:flex;flex-direction:column;align-items:center;justify-content:center}
    .thumb img{width:100%;height:160px;object-fit:cover;border-radius:6px}
    .meta{margin-top:8px;width:100%;display:flex;justify-content:space-between;align-items:center;font-size:13px;color:#666}
    .meta .id{color:#b07e09;font-weight:700}
    .no-photos{padding:40px;text-align:center;border:2px dashed rgba(0,0,0,0.06);color:#b07e09}
    .controls{display:flex;gap:10px;align-items:center}
    .btn{padding:8px 12px;border-radius:8px;border:2px solid #b07e09;background:transparent;color:#b07e09;font-weight:700}
    .btn.primary{background:#b07e09;color:#fff;border-color:#b07e09}
    /* preview modal */
    #previewModal{position:fixed;top:0;left:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;background:rgba(255,255,255,0.9);z-index:200}
    #previewModal.show{display:flex}
    #previewModal img{max-width:95%;max-height:85%;border-radius:8px;box-shadow:0 12px 40px rgba(0,0,0,0.08)}
    .modal-buttons{position:absolute;bottom:30px;display:flex;gap:12px}
    .modal-buttons button{padding:10px 14px;border-radius:8px;border:none;background:#b07e09;color:#fff;font-weight:700}
    footer{margin-top:22px;text-align:center;color:#666;font-size:13px}
    @media(max-width:600px){
      .thumb img{height:120px}
      .wrap{padding:12px;margin:18px auto}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <img src="/public/logo.png" alt="Logo">
      <div>
        <h1>Visualizador da Cabine</h1>
        <div style="font-size:12px;color:#666">Compartilhe suas fotos com o público</div>
      </div>
    </header>

    <div id="gallery" class="gallery">
      <!-- thumbs serão injetadas pelo JS -->
    </div>

    <div id="previewModal" role="dialog" aria-hidden="true">
      <img id="previewLarge" src="" alt="Preview">
      <div class="modal-buttons">
        <button id="closePreview">Fechar</button>
        <button id="download" class="primary">Baixar</button>
      </div>
    </div>

    <footer>
      <div>© Zerion Films</div>
    </footer>
  </div>

  <script>
    // Carregamento das fotos via socket / api (mantive a lógica original)
    const gallery = document.getElementById('gallery');
    const previewModal = document.getElementById('previewModal');
    const previewLarge = document.getElementById('previewLarge');
    const closePreview = document.getElementById('closePreview');
    const download = document.getElementById('download');

    // exemplo: lista de imagens (em produção vem do servidor)
    let currentPhotos = [];
    // Se houver um viewerId via query string, podemos buscar as fotos
    const params = new URLSearchParams(window.location.search);
    const viewerId = params.get('id');

    function renderGallery(photos){
      gallery.innerHTML = '';
      if(!photos || photos.length===0){
        gallery.innerHTML = "<div class='no-photos'>Nenhuma foto ainda — aguarde a sessão.</div>";
        return;
      }
      photos.forEach(p=>{
        const div = document.createElement('div');
        div.className = 'thumb';
        div.innerHTML = `<img src="${p.url}" alt="Foto"><div class="meta"><div class="id">${p.id}</div><div class="controls"><button class="btn" data-url="${p.url}">Ver</button></div></div>`;
        gallery.appendChild(div);
      });
      // attach events
      document.querySelectorAll('.btn').forEach(b=>{
        b.addEventListener('click', (e)=>{
          const url = e.currentTarget.getAttribute('data-url');
          previewLarge.src = url;
          previewModal.classList.add('show');
          previewModal.setAttribute('aria-hidden','false');
        });
      });
    }

    closePreview.addEventListener('click', ()=>{
      previewModal.classList.remove('show');
      previewModal.setAttribute('aria-hidden','true');
    });

    download.addEventListener('click', ()=>{
      const a = document.createElement('a');
      a.href = previewLarge.src;
      a.download = 'foto.png';
      document.body.appendChild(a);
      a.click();
      a.remove();
    });

    // Mock fetch (substituir pela fetch real)
    setTimeout(()=>{
      // ex de mock
      currentPhotos = [
        {id:'A1', url:'/public/video.png'},
        {id:'A2', url:'/public/imprimir (1).png'}
      ];
      renderGallery(currentPhotos);
    },1000);

    // Mostrar mensagem se não conectar
    setTimeout(() => {
      if (currentPhotos.length === 0 && viewerId) {
        gallery.innerHTML = "<div class='no-photos'>❌ Não foi possível carregar as fotos. Verifique o ID da sessão.</div>";
      }
    }, 5000);
  </script>
</body>
</html>
